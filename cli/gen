#!/bin/bash

ROOT="/var/www/gs/"
CLI_ROOT="/var/www/gs/cli"
LOG_DIR="/var/www/gs/log"
CLI_UTILS="$CLI_ROOT/utils.sh"
BG_DIR="$CLI_ROOT/bg"
PID_FILE="/tmp/gen-daemon.pid"
LOG_FILE="/var/www/gs/log/gen20.log"
DAEMON="$BG_DIR/daemon-update.sh"
BASE_DIR="$CLI_ROOT/com"

# Βεβαιώσου ότι το .env είναι φορτωμένο
ENV_FILE="/var/www/gs/.env"
if [ -f "$ENV_FILE" ]; then
    source "$ENV_FILE"
 #   echo "🔧 Το .env έχει φορτωθεί επιτυχώς."
else
    echo "❌ Σφάλμα: Λείπει το αρχείο .env."
    exit 1
fi

# Φορτώνουμε το utils.sh
if [ -f "$CLI_UTILS" ]; then
    source "$CLI_UTILS"
else
    echo "❌ Σφάλμα: Λείπει το αρχείο utils.sh."
    exit 1
fi

# Έλεγχος παραμέτρων
if [ -z "$1" ]; then
    echo "❌ Σφάλμα: Χρησιμοποιήστε τη σωστή σύνταξη: $0 <system> <command> [args...]"
    exit 1
fi

COMMAND="$1"
FILENAME="$2"

# Έλεγχος αν πρόκειται για προκαθορισμένη εντολή daemon
case "$COMMAND" in

start)
bash "$DAEMON start"
exit 0
;;

stop)
bash "$DAEMON stop"
exit 0
;;

restart)
bash "$DAEMON restart"
exit 0
;;
ai)
    echo "σύνδεση με ai"
    ;;
ws)
    bash "$CLI_ROOT/com/ws/$FILENAME.sh"
    ;;
all)
if [ -n "$FILENAME" ]; then
for dir in "$BASE_DIR"/*/; do
CMD_NAME=$(basename "$dir")
SCRIPT="$dir/$FILENAME.sh"
if [ -f "$SCRIPT" ]; then
    echo "▶ Εκτέλεση $CMD_NAME/$FILENAME.sh..."
    bash "$SCRIPT"
else
    echo "⚠ Λείπει το script για το $CMD_NAME/$FILENAME"
fi
done
else
echo "❌ Σφάλμα: Το FILENAME δεν έχει οριστεί."
exit 1
fi
;;

# Γλώσσες και εντολές που εκτελούν .sh αρχεία
php|python|go|node)
interpreter="${COMMAND}" # Αποθηκεύουμε το όνομα του διερμηνέα
script_name="${FILENAME}" # Το πλήρες όνομα του αρχείου
if [ -f "$script_name" ]; then
"${interpreter}" "${script_name}" # Εκτελούμε το script με τον κατάλληλο διερμηνέα
else
echo "Το αρχείο $script_name δεν βρέθηκε."
fi
;;

# Γλώσσες και εντολές που πρέπει να αποκτούν πρόσβαση μέσω CLI περιβάλλοντος
kronos)
    bash "$CLI_ROOT/com/kronos/$FILENAME.sh"
    ;;

redis)
  redis-cli --auth "yjF1f7uiHttcp"
  ;;

cubos)
 bash "$CLI_ROOT/com/cubos/$FILENAME.sh"
;;

git)
        GIT_SCRIPT="$CLI_ROOT/com/git/$FILENAME.sh"

        if [ -f "$GIT_SCRIPT" ]; then
            bash "$GIT_SCRIPT"
            exit $?
        else
            echo "❌ Σφάλμα: Το script Git ($GIT_SCRIPT) δεν βρέθηκε."
            exit 1
        fi
        ;;
ermis)
bash "$CLI_ROOT/com/ermis/$FILENAME.sh"
;;

mars)
bash "$CLI_ROOT/com/mars/$FILENAME.sh"
    ;;

god)
bash "$CLI_ROOT/com/god/$FILENAME.sh"
    ;;
composer)
  su - dros -c "cd '$ROOT/gaia' && composer '$COMMAND'"
  ;;
gaia)
  # Εκτέλεση του PHP script για το Gaia
  if [ -n "$FILENAME" ]; then
  # Pass all remaining arguments to the PHP script
  php "$CLI_ROOT/com/gaia/index.php" "$@"
  else
  echo "❌ Σφάλμα: Το FILENAME δεν έχει οριστεί για το Gaia."
  exit 1
  fi
  exit 0
  ;;
*)
    echo "❌ Άγνωστη υπηρεσία CLI για το $COMMAND"
    exit 1
    ;;
esac